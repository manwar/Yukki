#!/usr/bin/env perl
use 5.12.1;

use Yukki::Web;

use File::ShareDir qw( module_dir );
use File::Copy::Recursive qw( dircopy );
use Path::Class;
use YAML qw( LoadFile DumpFile );

my $site_dir = shift;

my $module_dir = module_dir('Yukki::Web');
my @files = glob "$module_dir/*";

$File::Copy::Recursive::KeepMode = 0;
dircopy($module_dir, $site_dir);

my $root = dir($site_dir)->absolute;
my $yaml = file($root, 'etc', 'yukki.conf');

my $config = LoadFile("$yaml");
$config->{root} = "$root";
chmod 0644, "$yaml";
DumpFile("$yaml", $config);
chmod 0444, "$yaml";

say "Please read the installation instructions if you have not:\n";
say "\tperldoc Yukki::Manual::Installation\n";

say "The rest of these remarks assume you run this first:\n";
say "\tcd $site_dir\n";

say "You probably want to setup your repositories by running:\n";
say "\tyukki-git-init $_" for sort keys %{ $config->{repositories} };
print "\n";

say "And then you'll want at least one user, so run:\n";
say "\tyukki-add-user\n";

say "To start your Yukki server, run:\n";
say "\tcd $site_dir; plackup yukki.psgi\n";

say "Have a nice day!";
